<!DOCTYPE html>
<!-- í•œêµ­ì–´ ì„¤ì •ìœ¼ë¡œ ë¬¸ì„œì˜ ê¸°ë³¸ ì–¸ì–´ë¥¼ ì§€ì •í•©ë‹ˆë‹¤ -->
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CERT í†µí•© ë³´ì•ˆ ìˆ˜ì‚¬ë³¸ë¶€ (Real-Engine)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .chart-container { position: relative; width: 100%; height: 250px; }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .check-item { transition: all 0.2s ease; }
        .check-item:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-slate-900 text-white shadow-xl sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center font-black text-white">CERT</div>
                <div>
                    <h1 class="text-base font-bold">CERT í†µí•© ìˆ˜ì‚¬ë³¸ë¶€</h1>
                    <p class="text-[9px] text-indigo-400 uppercase tracking-widest">Real-Time Security Engine</p>
                </div>
            </div>
            <nav class="hidden md:flex gap-6 text-xs font-bold">
                <button onclick="app.switchView('analysis')" class="hover:text-indigo-400 transition">ë¶„ì„ ì„¼í„°</button>
                <button onclick="app.switchView('system')" class="hover:text-indigo-400 transition">ì‹œìŠ¤í…œ ì ê²€ (SSH)</button>
            </nav>
            <div class="text-right">
                <p class="text-[10px] text-slate-500 font-bold">ì—”ì§„ ìƒíƒœ</p>
                <p class="text-xs text-emerald-400 font-bold">Connected</p>
            </div>
        </div>
    </header>

    <main class="flex-grow p-4 md:p-8 max-w-7xl mx-auto w-full">

        <!-- 1. ë¶„ì„ ì„¼í„° (íŒŒì¼ & ì´ë©”ì¼) -->
        <section id="view-analysis" class="space-y-8 fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 my-10">
                <!-- íŒŒì¼ ë¶„ì„ -->
                <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                    <h3 class="text-lg font-bold mb-4 flex items-center gap-2">ğŸ“‚ íŒŒì¼ ì •ë°€ ë¶„ì„ (PE/Hash)</h3>
                    <input type="file" id="file-input" class="hidden" onchange="app.uploadFile(this.files[0])">
                    <div id="file-drop-zone" class="border-2 border-dashed border-slate-100 bg-slate-50 rounded-2xl p-10 text-center cursor-pointer hover:bg-indigo-50 transition" onclick="document.getElementById('file-input').click()">
                        <p class="text-sm text-slate-500 font-bold">ë¶„ì„í•  íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                        <p class="text-[10px] text-slate-400 mt-2">ì‹¤ì œ MD5/SHA256 í•´ì‹œ ë° PE êµ¬ì¡° ë¶„ì„</p>
                    </div>
                    <div id="file-result" class="hidden mt-4 p-4 bg-slate-50 rounded-xl text-xs font-mono"></div>
                </div>
                <!-- ì´ë©”ì¼ ë¶„ì„ -->
                <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                    <h3 class="text-lg font-bold mb-4 flex items-center gap-2">ğŸ“§ ì´ë©”ì¼ í—¤ë” ë¶„ì„</h3>
                    <textarea id="email-header-input" class="w-full h-32 p-4 bg-slate-50 border border-slate-100 rounded-xl text-xs font-mono mb-4 outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Received í—¤ë”ë¥¼ í¬í•¨í•œ ì›ë¬¸..."></textarea>
                    <button onclick="app.analyzeEmail()" class="w-full py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition">í—¤ë” íŒŒì‹± ë° ê²½ë¡œ ì¶”ì </button>
                    <div id="email-result" class="hidden mt-4 p-4 bg-slate-50 rounded-xl text-xs font-mono h-40 overflow-y-auto custom-scrollbar"></div>
                </div>
            </div>
        </section>

        <!-- 2. ì‹œìŠ¤í…œ ì ê²€ ì„¼í„° (Real SSH) -->
        <section id="view-system" class="hidden space-y-6 fade-in">
            <div class="bg-indigo-900 text-white p-10 rounded-3xl shadow-2xl relative overflow-hidden mb-8">
                <div class="absolute -top-10 -right-10 w-64 h-64 bg-white/5 rounded-full blur-3xl"></div>
                <div class="relative z-10">
                    <h2 class="text-3xl font-black mb-2">ì‹œìŠ¤í…œ ì›ê²© ì§„ë‹¨ (SSH)</h2>
                    <p class="text-indigo-200 text-sm mb-6">ëŒ€ìƒ ì„œë²„ì— ì§ì ‘ SSHë¡œ ì ‘ì†í•˜ì—¬ ë³´ì•ˆ ì„¤ì •ì„ ì ê²€í•©ë‹ˆë‹¤.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-4xl bg-white/10 p-6 rounded-2xl border border-white/20 backdrop-blur-md">
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold uppercase text-indigo-300">Target Host</label>
                            <input type="text" id="ssh-host" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-2 text-white placeholder-indigo-300 outline-none" placeholder="192.168.1.100">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold uppercase text-indigo-300">Port</label>
                            <input type="number" id="ssh-port" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-2 text-white placeholder-indigo-300 outline-none" value="22">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold uppercase text-indigo-300">Username</label>
                            <input type="text" id="ssh-user" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-2 text-white placeholder-indigo-300 outline-none" placeholder="root">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold uppercase text-indigo-300">Password (Optional)</label>
                            <input type="password" id="ssh-pass" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-2 text-white placeholder-indigo-300 outline-none" placeholder="********">
                        </div>
                        <div class="col-span-2 space-y-2">
                            <label class="text-[10px] font-bold uppercase text-indigo-300">Private Key (Optional, PEM format)</label>
                            <textarea id="ssh-key" class="w-full h-20 bg-white/10 border border-white/20 rounded-xl px-4 py-2 text-white placeholder-indigo-300 outline-none text-xs font-mono" placeholder="-----BEGIN RSA PRIVATE KEY-----..."></textarea>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-end">
                        <button onclick="app.runSystemCheck()" id="btn-check" class="px-8 py-3 bg-emerald-500 text-white rounded-xl font-black shadow-lg hover:bg-emerald-600 transition active:scale-95">
                            ì‹¤ì œ ì—°ê²° ë° ì§„ë‹¨ ì‹œì‘
                        </button>
                    </div>
                </div>
            </div>

            <!-- ì§„ë‹¨ ê²°ê³¼ -->
            <div id="system-result-area" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-4">
                    <h3 class="font-bold text-slate-800">ì§„ë‹¨ ê²°ê³¼ ë¦¬í¬íŠ¸</h3>
                    <div id="check-list-container" class="space-y-4"></div>
                </div>
                <div class="space-y-6">
                    <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200 text-center">
                        <h4 class="text-xs font-bold text-slate-400 uppercase mb-4">ë³´ì•ˆ ì ìˆ˜</h4>
                        <p class="text-5xl font-black text-slate-800" id="system-score">--</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        const app = {
            // ë·° ì „í™˜
            switchView: function(viewId) {
                document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
                document.getElementById(`view-${viewId}`).classList.remove('hidden');
            },

            // 1. íŒŒì¼ ë¶„ì„ (Real API)
            uploadFile: async function(file) {
                if(!file) return;
                const formData = new FormData();
                formData.append("file", file);

                document.getElementById('file-result').classList.remove('hidden');
                document.getElementById('file-result').innerHTML = "â³ íŒŒì¼ ì—…ë¡œë“œ ë° ë¶„ì„ ì¤‘...";

                try {
                    const response = await fetch('/api/analyze/file', { method: 'POST', body: formData });
                    const data = await response.json();
                    
                    let html = `<p class="font-bold text-indigo-600">íŒŒì¼ëª…: ${data.filename}</p>`;
                    html += `<p>í¬ê¸°: ${data.size} bytes</p>`;
                    html += `<p>MD5: <span class="text-slate-500">${data.md5}</span></p>`;
                    html += `<p>SHA256: <span class="text-slate-500">${data.sha256}</span></p>`;
                    html += `<p class="mt-2 font-bold ${data.verdict.includes('Safe') ? 'text-emerald-500' : 'text-rose-500'}">íŒì •: ${data.verdict}</p>`;
                    if(data.details) html += `<p class="text-slate-400 mt-1">> ${data.details}</p>`;
                    
                    document.getElementById('file-result').innerHTML = html;
                } catch(e) {
                    document.getElementById('file-result').innerHTML = `âŒ ë¶„ì„ ì‹¤íŒ¨: ${e.message}`;
                }
            },

            // 2. ì´ë©”ì¼ ë¶„ì„ (Real API)
            analyzeEmail: async function() {
                const text = document.getElementById('email-header-input').value;
                if(!text) return alert("í—¤ë”ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

                document.getElementById('email-result').classList.remove('hidden');
                document.getElementById('email-result').innerHTML = "â³ í—¤ë” íŒŒì‹± ì¤‘...";

                try {
                    const response = await fetch('/api/analyze/email', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({header_text: text})
                    });
                    const data = await response.json();

                    let html = `<p><strong>Subject:</strong> ${data.subject}</p>`;
                    html += `<p><strong>From:</strong> ${data.from}</p>`;
                    html += `<p><strong>Auth:</strong> ${data.auth_status}</p>`;
                    html += `<hr class="my-2 border-slate-200">`;
                    html += `<p class="font-bold mb-1">ê²½ë¡œ ì¶”ì  (Hops):</p>`;
                    data.hops.forEach(h => {
                        html += `<div class="mb-1 pl-2 border-l-2 border-indigo-200">`;
                        html += `<p class="text-indigo-600 font-bold">${h.ips.join(', ')}</p>`;
                        html += `<p class="text-[10px] text-slate-400 truncate">${h.raw}</p></div>`;
                    });

                    document.getElementById('email-result').innerHTML = html;
                } catch(e) {
                    document.getElementById('email-result').innerHTML = `âŒ ë¶„ì„ ì‹¤íŒ¨: ${e.message}`;
                }
            },

            // 3. ì‹œìŠ¤í…œ ì ê²€ (Real SSH)
            runSystemCheck: async function() {
                const host = document.getElementById('ssh-host').value;
                const port = document.getElementById('ssh-port').value;
                const user = document.getElementById('ssh-user').value;
                const pass = document.getElementById('ssh-pass').value;
                const key = document.getElementById('ssh-key').value;

                if(!host || !user) return alert("ì ‘ì† ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

                const btn = document.getElementById('btn-check');
                btn.disabled = true;
                btn.innerHTML = "â³ ì ‘ì† ë° ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì¤‘...";
                document.getElementById('system-result-area').classList.add('hidden');

                try {
                    const response = await fetch('/api/system/check', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            host: host, port: parseInt(port), username: user, 
                            password: pass || null, private_key: key || null
                        })
                    });
                    
                    const data = await response.json();
                    
                    if(response.status !== 200) throw new Error(data.error || "ì—°ê²° ì‹¤íŒ¨");

                    // ê²°ê³¼ ë Œë”ë§
                    document.getElementById('system-result-area').classList.remove('hidden');
                    document.getElementById('system-score').innerText = data.score;
                    
                    const container = document.getElementById('check-list-container');
                    container.innerHTML = "";
                    
                    data.results.forEach(item => {
                        const div = document.createElement('div');
                        div.className = "bg-white p-4 rounded-xl border border-slate-200 shadow-sm";
                        div.innerHTML = `
                            <div class="flex justify-between items-start">
                                <div>
                                    <span class="text-[10px] font-bold px-2 py-0.5 rounded bg-slate-100 text-slate-500">${item.cat}</span>
                                    <h4 class="font-bold text-slate-800 mt-1">${item.title}</h4>
                                    <p class="text-xs text-slate-500 mt-1">${item.desc}</p>
                                </div>
                                <span class="text-xs font-bold ${item.result === 'ì–‘í˜¸' ? 'text-emerald-500' : 'text-rose-500'}">${item.result}</span>
                            </div>
                            <div class="mt-3 p-3 bg-indigo-50 rounded-lg text-[11px] text-indigo-700">
                                ğŸ’¡ <strong>ê°€ì´ë“œ:</strong> ${item.guide}
                            </div>
                        `;
                        container.appendChild(div);
                    });

                } catch(e) {
                    alert("ì˜¤ë¥˜ ë°œìƒ: " + e.message);
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = "ì‹¤ì œ ì—°ê²° ë° ì§„ë‹¨ ì‹œì‘";
                }
            }
        };
    </script>
</body>
</html>
