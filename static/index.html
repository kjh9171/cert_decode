<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CERT í†µí•© ë³´ì•ˆ ìˆ˜ì‚¬ë³¸ë¶€ V3.3 - ì™„ì „ì²´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f1f5f9; color: #1e293b; overflow-x: hidden; }
        .chart-container { position: relative; width: 100%; height: 250px; }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .tool-card { transition: all 0.2s ease; border: 1px solid #e2e8f0; cursor: pointer; }
        .tool-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border-color: #6366f1; }
        .log-line { border-left: 2px solid #e2e8f0; padding-left: 1rem; margin-bottom: 0.5rem; font-size: 0.75rem; font-family: monospace; }
        .log-line.active { border-left-color: #6366f1; color: #4f46e5; font-weight: bold; }
        .mail-hop-node { position: relative; padding-left: 2rem; border-left: 2px dashed #cbd5e1; margin-bottom: 1.5rem; }
        .mail-hop-node::before { content: ''; position: absolute; left: -7px; top: 0; width: 12px; height: 12px; background-color: #6366f1; border-radius: 50%; }
        .check-item { transition: all 0.2s ease; cursor: pointer; }
        .check-item.active .remedy-area { max-height: 500px; padding: 1.5rem; border-top: 1px solid #f1f5f9; }
        .remedy-area { max-height: 0; overflow: hidden; transition: all 0.3s ease-out; background-color: #f8fafc; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="bg-indigo-950 text-white shadow-xl sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center font-black text-white border border-white/20 shadow-lg">CERT</div>
                <div>
                    <h1 class="text-base font-bold leading-tight">CERT í†µí•© ìˆ˜ì‚¬ë³¸ë¶€</h1>
                    <p class="text-[9px] text-indigo-400 uppercase tracking-widest">Master Forensic & Security Suite</p>
                </div>
            </div>
            <nav class="hidden md:flex gap-8 text-xs font-bold uppercase tracking-widest">
                <button onclick="app.switchView('analysis')" id="nav-analysis" class="text-indigo-400 border-b-2 border-indigo-400 pb-1 hover:text-white transition">ìˆ˜ì‚¬ ì„¼í„°</button>
                <button onclick="app.switchView('codec')" id="nav-codec" class="hover:text-indigo-400 transition">ë””ì½”ë“œ ì„¼í„°</button>
                <button onclick="app.switchView('system')" id="nav-system" class="hover:text-indigo-400 transition">ì ê²€ ì„¼í„°</button>
            </nav>
            <div class="text-right">
                <p class="text-[9px] text-indigo-300 font-bold uppercase">Investigation Status</p>
                <p class="text-xs text-emerald-400 font-bold flex items-center gap-1 justify-end">
                    <span class="w-1.5 h-1.5 bg-emerald-400 rounded-full animate-pulse"></span> Engine Active
                </p>
            </div>
        </div>
    </header>

    <main class="flex-grow p-4 md:p-8 max-w-7xl mx-auto w-full">

        <!-- ì„¹ì…˜ 1: ë¶„ì„ ì„¼í„° (íŒŒì¼ & ì´ë©”ì¼) -->
        <section id="view-analysis" class="space-y-8 fade-in">
            <div class="bg-white rounded-3xl p-8 shadow-sm border border-slate-200">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
                    <div>
                        <h2 class="text-2xl font-black text-slate-800 uppercase tracking-tight">Investigation Center</h2>
                        <p class="text-slate-500 text-xs">íŒŒì¼ í•´ì‹œ ë¶„ì„, PE êµ¬ì¡° ìˆ˜ìƒ‰ ë° ì´ë©”ì¼ ê²½ë¡œ ì¶”ì ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
                    </div>
                    <div class="bg-indigo-50 px-4 py-2 rounded-xl border border-indigo-100 min-w-[150px]">
                        <p class="text-[10px] text-indigo-600 font-bold uppercase">Current Target</p>
                        <p id="current-target-name" class="text-xs font-bold text-indigo-900 truncate">None</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- íŒŒì¼ ìˆ˜ì‚¬ ì…ë ¥ -->
                    <div class="tool-card bg-white p-6 rounded-2xl">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">ğŸ“¦</span>
                            <h3 class="font-bold text-slate-700 text-sm">ì—”ë“œí¬ì¸íŠ¸ íŒŒì¼ ë¶„ì„</h3>
                        </div>
                        <input type="file" id="file-input" class="hidden" onchange="app.handleFileSelect(event)">
                        <div id="file-drop-zone" onclick="document.getElementById('file-input').click()" class="border-2 border-dashed border-slate-200 bg-slate-50/50 rounded-xl p-10 text-center hover:border-indigo-400 transition-all">
                            <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Drop Malware or Click</p>
                            <p class="text-[10px] text-slate-300 mt-2 font-medium">EXE, DLL, PDF, JS, HWP, etc.</p>
                        </div>
                    </div>
                    <!-- ì´ë©”ì¼ ìˆ˜ì‚¬ ì…ë ¥ -->
                    <div class="tool-card bg-white p-6 rounded-2xl">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">ğŸ“§</span>
                            <h3 class="font-bold text-slate-700 text-sm">ì´ë©”ì¼ í—¤ë” í¬ë Œì‹</h3>
                        </div>
                        <textarea id="email-header-input" class="w-full h-32 p-4 bg-slate-50 border border-slate-200 rounded-xl text-xs font-mono outline-none focus:ring-2 focus:ring-indigo-500 custom-scrollbar" placeholder="Received í—¤ë” ì›ë¬¸ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
                        <button onclick="app.analyzeEmail()" class="w-full mt-4 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition shadow-lg shadow-indigo-100">ìˆ˜ì‚¬ ì‹œì‘ (Start Analysis)</button>
                    </div>
                </div>
            </div>

            <!-- ë¶„ì„ ê²°ê³¼ ì°½ -->
            <div id="analysis-result-stage" class="hidden space-y-6">
                <!-- ê²°ê³¼ ìƒë‹¨ ìš”ì•½ -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm text-center">
                        <p class="text-[10px] text-slate-400 font-bold uppercase mb-1">Target Type</p>
                        <p id="res-file-type" class="text-sm font-black text-slate-800">--</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm text-center">
                        <p class="text-[10px] text-slate-400 font-bold uppercase mb-1">Threat Verdict</p>
                        <p id="res-verdict" class="text-sm font-black">--</p>
                    </div>
                    <div class="md:col-span-2 bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                        <p class="text-[10px] text-slate-400 font-bold uppercase mb-1">Hash Identity</p>
                        <p id="res-hashes" class="text-[10px] font-mono text-slate-500 truncate">--</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- ìˆ˜ì‚¬ ë¡œê·¸ -->
                    <div class="bg-slate-900 text-white p-6 rounded-2xl shadow-xl border border-slate-800">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest">Real-Time Logs</h3>
                            <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
                        </div>
                        <div id="analysis-logs" class="space-y-2 h-64 overflow-y-auto custom-scrollbar">
                            <!-- JS logs -->
                        </div>
                    </div>
                    <!-- ë¶„ì„ ê²°ê³¼ ìƒì„¸ -->
                    <div class="lg:col-span-2 bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                        <h3 class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-4">Detailed Investigation Report</h3>
                        <div id="analysis-details-content" class="h-64 overflow-y-auto custom-scrollbar">
                            <!-- Result content -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ì„¹ì…˜ 2: ë””ì½”ë“œ ì„¼í„° -->
        <section id="view-codec" class="hidden space-y-6 fade-in">
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-2xl font-black text-slate-800 uppercase tracking-tight">Decoder & Encoder</h2>
                        <p class="text-slate-500 text-xs mt-1">ë¶„ì„ ì¤‘ ë§ˆì£¼ì¹˜ëŠ” ë‚œë…í™” ë°ì´í„°ë¥¼ ì¦‰ì‹œ í•´ë…í•©ë‹ˆë‹¤.</p>
                    </div>
                    <div class="flex bg-slate-100 p-1 rounded-xl">
                        <button onclick="codec.setMode('decode')" id="mode-decode" class="px-4 py-2 bg-white rounded-lg text-xs font-bold shadow-sm transition text-slate-800">DECODE</button>
                        <button onclick="codec.setMode('encode')" id="mode-encode" class="px-4 py-2 text-slate-500 text-xs font-bold transition">ENCODE</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="space-y-2">
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest px-1">Raw Input</label>
                        <textarea id="codec-input" class="w-full h-80 p-6 bg-slate-50 border border-slate-200 rounded-2xl text-sm font-mono focus:ring-2 focus:ring-indigo-500 outline-none custom-scrollbar" placeholder="ë³€í™˜í•  ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì‹­ì‹œì˜¤..."></textarea>
                    </div>
                    <div class="space-y-6">
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest px-1">Control Panel</label>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                <button onclick="codec.run('url')" class="p-4 bg-white border border-slate-200 rounded-xl text-xs font-bold hover:border-indigo-600 hover:text-indigo-600 transition shadow-sm">URL</button>
                                <button onclick="codec.run('base64')" class="p-4 bg-white border border-slate-200 rounded-xl text-xs font-bold hover:border-indigo-600 hover:text-indigo-600 transition shadow-sm">Base64</button>
                                <button onclick="codec.run('hex')" class="p-4 bg-white border border-slate-200 rounded-xl text-xs font-bold hover:border-indigo-600 hover:text-indigo-600 transition shadow-sm">HEX</button>
                                <button onclick="codec.run('charcode')" class="p-4 bg-white border border-slate-200 rounded-xl text-xs font-bold hover:border-indigo-600 hover:text-indigo-600 transition shadow-sm">CharCode</button>
                                <button onclick="codec.run('gubun')" class="p-4 bg-white border border-slate-200 rounded-xl text-xs font-bold hover:border-indigo-600 hover:text-indigo-600 transition shadow-sm">Gubun ì¶”ì¶œ</button>
                                <button onclick="codec.clear()" class="p-4 bg-rose-50 text-rose-600 border border-rose-100 rounded-xl text-xs font-bold hover:bg-rose-100 transition shadow-sm">ì´ˆê¸°í™”</button>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest px-1">Parsed Output</label>
                            <div id="codec-output" class="w-full h-48 p-6 bg-slate-900 text-emerald-400 border border-slate-800 rounded-2xl text-sm font-mono overflow-y-auto custom-scrollbar whitespace-pre-wrap"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ì„¹ì…˜ 3: ì‹œìŠ¤í…œ ì ê²€ ì„¼í„° -->
        <section id="view-system" class="hidden space-y-6 fade-in">
            <div class="bg-indigo-950 text-white p-10 rounded-3xl shadow-2xl relative overflow-hidden mb-8 border border-white/10">
                <div class="absolute -top-10 -right-10 w-64 h-64 bg-indigo-500/10 rounded-full blur-3xl"></div>
                <div class="relative z-10 flex flex-col lg:flex-row justify-between gap-12">
                    <div class="space-y-6 flex-grow">
                        <h2 class="text-3xl font-black uppercase tracking-tighter">System Auditor</h2>
                        <p class="text-indigo-200 text-sm max-w-lg leading-relaxed">SSH ë³´ì•ˆ í†µì‹ ì„ í†µí•´ ëŒ€ìƒ ì„œë²„ì˜ ì„¤ì • ë¯¸ë¹„ì™€ ì·¨ì•½ì ì„ ì‹¤ì‹œê°„ ì ê²€í•©ë‹ˆë‹¤.</p>
                        <div class="p-5 bg-white/5 rounded-2xl border border-white/10 space-y-3">
                            <p class="text-xs font-bold text-emerald-400 flex items-center gap-2">
                                <span>ğŸš€</span> ì‹¤ì „ ì—°ê²° ê°€ì´ë“œ
                            </p>
                            <ul class="text-[11px] text-indigo-100/60 space-y-1">
                                <li>â€¢ SSH (Port 22)ê°€ ê°œë°©ëœ Linux ê³„ì—´ ê¶Œì¥</li>
                                <li>â€¢ ì ê²€ìš© ê³„ì •ì€ Root ë˜ëŠ” Sudo ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤</li>
                                <li>â€¢ ì™¸ë¶€ë§ ì—°ê²° ì‹œ ë°©í™”ë²½ í—ˆìš© ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="bg-white/10 p-8 rounded-2xl border border-white/20 backdrop-blur-md w-full lg:max-w-md space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-indigo-300 uppercase">Host IP</label>
                                <input type="text" id="ssh-host" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-400" placeholder="127.0.0.1">
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-indigo-300 uppercase">Port</label>
                                <input type="number" id="ssh-port" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-400" value="22">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-indigo-300 uppercase">Username</label>
                                <input type="text" id="ssh-user" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-400" placeholder="root">
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-indigo-300 uppercase">Password</label>
                                <input type="password" id="ssh-pass" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-400" placeholder="********">
                            </div>
                        </div>
                        <button onclick="app.runSystemCheck()" id="btn-system-check" class="w-full py-4 bg-emerald-500 text-white rounded-xl font-black shadow-lg hover:bg-emerald-600 transition active:scale-95 uppercase tracking-widest text-sm mt-4">ì§„ë‹¨ ì‹œì‘ (Execute Audit)</button>
                    </div>
                </div>
            </div>

            <!-- ì§„ë‹¨ ê²°ê³¼ -->
            <div id="system-result-area" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-4" id="system-check-list"></div>
                <div class="space-y-6 text-center">
                    <div class="bg-white p-10 rounded-3xl shadow-sm border border-slate-200">
                        <h4 class="text-xs font-bold text-slate-400 uppercase mb-4 tracking-widest">Security Score</h4>
                        <p class="text-7xl font-black text-slate-800" id="system-total-score">--</p>
                    </div>
                    <div class="bg-slate-900 text-white p-8 rounded-3xl shadow-2xl border border-slate-800">
                        <h4 class="text-xs font-bold text-indigo-400 uppercase mb-4 tracking-widest">CERT Verdict</h4>
                        <p id="system-total-advice" class="text-xs leading-relaxed italic text-slate-300">--</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        // ---------------------------------------------------------
        // ì „ì—­ ì•± ê´€ë¦¬ì
        // ---------------------------------------------------------
        const app = {
            state: { currentView: 'analysis', targetName: '' },

            // 1. ì„¼í„° ì „í™˜
            switchView: function(viewId) {
                document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
                document.getElementById(`view-${viewId}`).classList.remove('hidden');
                
                // ë‚´ë¹„ ë²„íŠ¼ ìŠ¤íƒ€ì¼
                document.querySelectorAll('nav button').forEach(b => {
                    b.classList.remove('text-indigo-400', 'border-b-2', 'border-indigo-400', 'pb-1');
                });
                document.getElementById(`nav-${viewId}`).classList.add('text-indigo-400', 'border-b-2', 'border-indigo-400', 'pb-1');
            },

            // 2. ìˆ˜ì‚¬ ë¡œê·¸ ì¶œë ¥
            log: function(msg, isActive = false) {
                const container = document.getElementById('analysis-logs');
                const line = document.createElement('div');
                line.className = `log-line ${isActive ? 'active' : ''}`;
                line.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
                container.appendChild(line);
                container.scrollTop = container.scrollHeight;
            },

            // 3. íŒŒì¼ ì—…ë¡œë“œ ë° ë¶„ì„
            handleFileSelect: function(e) { if(e.target.files[0]) this.uploadFile(e.target.files[0]); },
            uploadFile: async function(file) {
                this.state.targetName = file.name;
                document.getElementById('current-target-name').innerText = file.name;
                document.getElementById('analysis-result-stage').classList.remove('hidden');
                
                const logBox = document.getElementById('analysis-logs');
                const contentBox = document.getElementById('analysis-details-content');
                logBox.innerHTML = ""; contentBox.innerHTML = "â³ ë¶„ì„ ì—”ì§„ ëŒ€ê¸° ì¤‘...";

                this.log(`ëŒ€ìƒ íŒŒì¼ ê°ì§€: ${file.name}`);
                this.log(`í™•ì¥ì íŒë³„: .${file.name.split('.').pop()}`, true);

                const formData = new FormData();
                formData.append("file", file);

                try {
                    this.log("ë°±ì—”ë“œ ìˆ˜ì‚¬ ì—”ì§„(FastAPI)ìœ¼ë¡œ íŒŒì¼ ì „ì†¡ ì¤‘...");
                    const response = await fetch('/api/analyze/file', { method: 'POST', body: formData });
                    const data = await response.json();
                    
                    this.log("MD5 / SHA256 í•´ë… ì™„ë£Œ");
                    this.log("PE êµ¬ì¡° ë¶„ì„ ë° ì„í¬íŠ¸ í…Œì´ë¸” ìˆ˜ìƒ‰ ì™„ë£Œ", true);
                    this.log("ìˆ˜ì‚¬ ê²°ê³¼ ìˆ˜ì‹  ì„±ê³µ!");

                    document.getElementById('res-file-type').innerText = data.type;
                    document.getElementById('res-verdict').innerText = data.verdict;
                    document.getElementById('res-verdict').className = `text-sm font-black ${data.verdict.includes('Safe') ? 'text-emerald-500' : 'text-rose-600'}`;
                    document.getElementById('res-hashes').innerHTML = `MD5: ${data.md5}<br>SHA256: ${data.sha256}`;

                    contentBox.innerHTML = `
                        <div class="space-y-4">
                            <p class="font-bold text-indigo-600">CERT ê³µì‹ ì†Œê²¬: ${data.verdict}</p>
                            <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 grid grid-cols-2 gap-4">
                                <div><p class="text-[10px] font-bold text-slate-400">íŒŒì¼ ìƒì„¸</p><p class="text-xs">í¬ê¸°: ${(data.size/1024).toFixed(2)}KB</p></div>
                                <div><p class="text-[10px] font-bold text-slate-400">ë¶„ì„ ê²°ê³¼</p><p class="text-xs">${data.details}</p></div>
                            </div>
                        </div>
                    `;
                } catch(e) { this.log(`âŒ ì—ëŸ¬: ${e.message}`); }
            },

            // 4. ì´ë©”ì¼ ë¶„ì„
            analyzeEmail: async function() {
                const text = document.getElementById('email-header-input').value;
                if(!text) return alert("í—¤ë” ì›ë¬¸ì„ ì…ë ¥í•˜ì‹­ì‹œì˜¤.");

                this.state.targetName = "E-mail Forensic";
                document.getElementById('current-target-name').innerText = this.state.targetName;
                document.getElementById('analysis-result-stage').classList.remove('hidden');
                document.getElementById('analysis-logs').innerHTML = "";
                
                this.log("í—¤ë” ë°ì´í„° ìˆ˜ì‹  ì™„ë£Œ");
                this.log("Received í™‰(Hop) ì¶”ì¶œ ì¤‘...", true);

                try {
                    const response = await fetch('/api/analyze/email', {
                        method: 'POST', headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({header_text: text})
                    });
                    const data = await response.json();
                    this.log(`ë°œì‹ ì ì‹ë³„: ${data.from}`);
                    this.log("ìµœì¢… ë¶„ì„ ì™„ë£Œ", true);

                    document.getElementById('res-file-type').innerText = "E-mail Message";
                    document.getElementById('res-verdict').innerText = data.verdict;
                    document.getElementById('res-verdict').className = `text-sm font-black ${data.verdict === 'Normal' ? 'text-emerald-500' : 'text-rose-600'}`;
                    document.getElementById('res-hashes').innerText = `Subject: ${data.subject}`;

                    let hops = data.hops.map((h, i) => `
                        <div class="mail-hop-node ${i === data.hops.length-1 ? 'border-none' : ''}">
                            <p class="text-xs font-bold text-slate-700">Hop #${data.hops.length-i}: ${h.ips.join(', ') || 'Internal'}</p>
                            <p class="text-[9px] text-slate-400 truncate">${h.raw}</p>
                        </div>`).join('');
                    document.getElementById('analysis-details-content').innerHTML = `<div class="space-y-4"><div><h4 class="text-xs font-bold text-slate-400 uppercase mb-3">Delivery Route</h4>${hops}</div></div>`;
                } catch(e) { this.log("âŒ ì‹¤íŒ¨: " + e.message); }
            },

            // 5. ì‹œìŠ¤í…œ ì ê²€
            runSystemCheck: async function() {
                const host = document.getElementById('ssh-host').value;
                const user = document.getElementById('ssh-user').value;
                const pass = document.getElementById('ssh-pass').value;
                if(!host || !user) return alert("ì ‘ì† ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹­ì‹œì˜¤.");

                const btn = document.getElementById('btn-system-check');
                btn.disabled = true; btn.innerHTML = "â³ SSH ì„¸ì…˜ ìˆ˜ë¦½ ì¤‘...";
                document.getElementById('system-result-area').classList.add('hidden');

                try {
                    const res = await fetch('/api/system/check', {
                        method: 'POST', headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ host, port: parseInt(document.getElementById('ssh-port').value), username: user, password: pass })
                    });
                    const data = await res.json();
                    if(res.status !== 200) throw new Error(data.error);

                    document.getElementById('system-result-area').classList.remove('hidden');
                    document.getElementById('system-total-score').innerText = data.score;
                    document.getElementById('system-total-advice').innerText = data.score < 80 ? "ë³´ì•ˆ ê²°í•¨ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ì¦‰ì‹œ ì¡°ì¹˜í•˜ì‹­ì‹œì˜¤!" : "ì‹œìŠ¤í…œì´ ë§¤ìš° ì•ˆì „í•œ ìƒíƒœì…ë‹ˆë‹¤.";

                    document.getElementById('system-check-list').innerHTML = data.results.map(r => `
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 check-item" onclick="this.classList.toggle('active')">
                            <div class="flex justify-between items-center font-bold">
                                <div><span class="text-[9px] px-2 py-0.5 rounded bg-slate-100 text-slate-500 mr-2">${r.cat}</span><span class="text-slate-800 text-sm">${r.title}</span></div>
                                <span class="${r.score === 100 ? 'text-emerald-500' : 'text-rose-500'} text-xs">${r.result}</span>
                            </div>
                            <div class="remedy-area"><p class="text-[11px] text-slate-600 leading-relaxed">ğŸ’¡ <strong>ì¡°ì¹˜:</strong> ${r.guide}</p></div>
                        </div>`).join('');
                } catch(e) { alert("ì—°ê²° ì‹¤íŒ¨: " + e.message); }
                finally { btn.disabled = false; btn.innerHTML = "ì§„ë‹¨ ì‹œì‘"; }
            }
        };

        // ---------------------------------------------------------
        // ì½”ë± ì„¼í„° (ì™„ë²½ ë³µêµ¬)
        // ---------------------------------------------------------
        const codec = {
            mode: 'decode',
            setMode: function(m) {
                this.mode = m;
                document.getElementById('mode-decode').className = m === 'decode' ? "px-4 py-2 bg-white rounded-lg text-xs font-bold shadow-sm transition text-slate-800" : "px-4 py-2 text-slate-500 text-xs font-bold transition";
                document.getElementById('mode-encode').className = m === 'encode' ? "px-4 py-2 bg-white rounded-lg text-xs font-bold shadow-sm transition text-slate-800" : "px-4 py-2 text-slate-500 text-xs font-bold transition";
            },
            run: function(type) {
                const input = document.getElementById('codec-input').value;
                if(!input) return alert("ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì‹­ì‹œì˜¤.");
                let r = "";
                try {
                    if(type === 'url') r = this.mode === 'decode' ? decodeURIComponent(input) : encodeURIComponent(input);
                    else if(type === 'base64') r = this.mode === 'decode' ? atob(input) : btoa(input);
                    else if(type === 'hex') {
                        if(this.mode === 'decode') r = input.replace(/\s/g, '').match(/.{1,2}/g).map(h => String.fromCharCode(parseInt(h, 16))).join('');
                        else r = Array.from(input).map(c => c.charCodeAt(0).toString(16).padStart(2, '0')).join(' ');
                    }
                    else if(type === 'charcode') {
                        if(this.mode === 'decode') r = input.split(/[\s,]+/).map(c => String.fromCharCode(parseInt(c))).join('');
                        else r = Array.from(input).map(c => c.charCodeAt(0)).join(', ');
                    }
                    else if(type === 'gubun') r = input.split('\n').map(l => l.substring(10, 61).trim()).join('\n');
                } catch(e) { r = "Error: " + e.message; }
                document.getElementById('codec-output').innerText = r;
            },
            clear: function() { document.getElementById('codec-input').value = ""; document.getElementById('codec-output').innerText = ""; }
        };

        window.onload = () => { app.init(); app.switchView('analysis'); };
    </script>
</body>
</html>
