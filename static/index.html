<!DOCTYPE html>
<!-- í•œêµ­ì–´ ì„¤ì •ìœ¼ë¡œ ë¬¸ì„œì˜ ê¸°ë³¸ ì–¸ì–´ë¥¼ ì§€ì •í•©ë‹ˆë‹¤ -->
<html lang="ko">
<head>
    <!-- ë¸Œë¼ìš°ì € ì¸ì½”ë”©ì„ UTF-8ë¡œ ì„¤ì •í•˜ì—¬ í•œê¸€ ê¹¨ì§ì„ ë°©ì§€í•©ë‹ˆë‹¤ -->
    <meta charset="UTF-8">
    <!-- ëª¨ë°”ì¼ ê¸°ê¸°ì—ì„œë„ í™”ë©´ì´ ìµœì í™”ë˜ë„ë¡ ë·°í¬íŠ¸ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- í†µí•© ë³´ì•ˆ ìˆ˜ì‚¬ë³¸ë¶€ V3.3 ìµœì¢… í†µí•©ë³¸ ì œëª©ì…ë‹ˆë‹¤ -->
    <title>CERT í†µí•© ë³´ì•ˆ ìˆ˜ì‚¬ë³¸ë¶€ V3.3</title>
    <!-- ë””ìì¸ ìƒì‚°ì„±ì„ ìœ„í•´ í…Œì¼ìœˆë“œ CSS í”„ë ˆì„ì›Œí¬ë¥¼ ì™¸ë¶€ CDNì—ì„œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ë°ì´í„° ì‹œê°í™”ë¥¼ ìœ„í•œ Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì™¸ë¶€ CDNì—ì„œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ì‹œìŠ¤í…œ ì „ì²´ì— ë…¸í† ì‚°ìŠ¤ í•œê¸€ í°íŠ¸ë¥¼ ì ìš©í•©ë‹ˆë‹¤ */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        body {
            /* í°íŠ¸ íŒ¨ë°€ë¦¬ ì§€ì • ë° ë°°ê²½ìƒ‰ì„ ì„¸ë ¨ëœ ë°ì€ íšŒìƒ‰ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤ */
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f1f5f9;
            color: #1e293b;
            overflow-x: hidden;
        }

        /* ì°¨íŠ¸ê°€ ë¶€ëª¨ ìš”ì†Œì— ë§ì¶° ìœ ë™ì ìœ¼ë¡œ í¬ê¸°ê°€ ë³€í•˜ë„ë¡ ì»¨í…Œì´ë„ˆë¥¼ ì •ì˜í•©ë‹ˆë‹¤ */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            margin: auto;
            height: 250px;
        }

        /* í™”ë©´ ë“±ì¥ ì‹œ ë¶€ë“œëŸ½ê²Œ ë‚˜íƒ€ë‚˜ëŠ” ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ì…ë‹ˆë‹¤ */
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” ë””ìì¸ìœ¼ë¡œ ê°€ë…ì„±ì„ ë†’ì…ë‹ˆë‹¤ */
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        /* ê¸°ëŠ¥ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .tool-card { transition: all 0.2s ease; border: 1px solid #e2e8f0; }
        .tool-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border-color: #6366f1; }

        /* ë¶„ì„ ë¡œê·¸ ì• ë‹ˆë©”ì´ì…˜ */
        .log-line { border-left: 2px solid #e2e8f0; padding-left: 1rem; margin-bottom: 0.5rem; font-size: 0.75rem; }
        .log-line.active { border-left-color: #6366f1; color: #4f46e5; font-weight: bold; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- ìƒë‹¨ í†µí•© í—¤ë”: ê° ë¶„ì„ ì„¼í„°ë¡œ ì´ë™í•  ìˆ˜ ìˆëŠ” ë‚´ë¹„ê²Œì´ì…˜ ë°”ì…ë‹ˆë‹¤ -->
    <header class="bg-indigo-950 text-white shadow-xl sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center font-black text-indigo-300 border border-white/20">CERT</div>
                <div>
                    <h1 class="text-base font-bold leading-tight">CERT í†µí•© ìˆ˜ì‚¬ë³¸ë¶€</h1>
                    <p class="text-[9px] text-indigo-400 uppercase tracking-widest">Advanced Threat Forensics Engine</p>
                </div>
            </div>
            <!-- ìˆ˜ì‚¬ë³¸ë¶€ ë‚´ ì£¼ìš” ì„¼í„° ì´ë™ ë²„íŠ¼ì…ë‹ˆë‹¤ -->
            <nav class="hidden md:flex gap-8 text-xs font-bold uppercase tracking-widest">
                <button onclick="app.switchView('analysis')" id="nav-analysis" class="text-indigo-400 hover:text-white transition">ìˆ˜ì‚¬ ì„¼í„°</button>
                <button onclick="app.switchView('codec')" id="nav-codec" class="hover:text-indigo-400 transition">ë””ì½”ë“œ ì„¼í„°</button>
                <button onclick="app.switchView('system')" id="nav-system" class="hover:text-indigo-400 transition">ì ê²€ ì„¼í„°</button>
            </nav>
            <div class="text-right">
                <p class="text-[9px] text-indigo-300 font-bold uppercase">System Status</p>
                <p class="text-xs text-emerald-400 font-bold flex items-center gap-1 justify-end">
                    <span class="w-1.5 h-1.5 bg-emerald-400 rounded-full animate-pulse"></span> Engine Ready
                </p>
            </div>
        </div>
    </header>

    <main class="flex-grow p-4 md:p-8 max-w-7xl mx-auto w-full">

        <!-- ì„¹ì…˜ 1: ë¶„ì„ ì„¼í„° (íŒŒì¼ ë° ì´ë©”ì¼) -->
        <section id="view-analysis" class="space-y-8 fade-in">
            <div class="bg-white rounded-3xl p-8 shadow-sm border border-slate-200">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
                    <div>
                        <h2 class="text-2xl font-black text-slate-800">ìœ„í˜‘ ìš”ì†Œ ì •ë°€ ìˆ˜ì‚¬</h2>
                        <p class="text-slate-500 text-xs mt-1">íŒŒì¼ ë° ì´ë©”ì¼ í—¤ë”ë¥¼ ëœ¯ì–´ë‚´ì–´ ì•…ì„± ì§•í›„ë¥¼ í¬ì°©í•©ë‹ˆë‹¤.</p>
                    </div>
                    <div class="bg-indigo-50 px-4 py-2 rounded-xl border border-indigo-100">
                        <p class="text-[10px] text-indigo-600 font-bold uppercase">Investigation Target</p>
                        <p class="text-xs font-bold text-indigo-900" id="current-target-name">None Selected</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- íŒŒì¼ ìˆ˜ì‚¬ ì…ë ¥ -->
                    <div class="tool-card bg-slate-50/50 p-6 rounded-2xl">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">ğŸ“¦</span>
                            <h3 class="font-bold text-slate-700 text-sm">ì—”ë“œí¬ì¸íŠ¸ íŒŒì¼ ìˆ˜ì‚¬</h3>
                        </div>
                        <input type="file" id="file-input" class="hidden" onchange="app.uploadFile(this.files[0])">
                        <div onclick="document.getElementById('file-input').click()" class="border-2 border-dashed border-slate-200 bg-white rounded-xl p-10 text-center cursor-pointer hover:border-indigo-400 transition-all">
                            <p class="text-xs font-bold text-slate-400">ë¶„ì„í•  íŒŒì¼ì„ ì—¬ê¸°ì— ë˜ì§€ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</p>
                            <p class="text-[10px] text-slate-300 mt-2">EXE, DLL, PDF, JS ë“± ëª¨ë“  í™•ì¥ì ì§€ì›</p>
                        </div>
                    </div>
                    <!-- ì´ë©”ì¼ ìˆ˜ì‚¬ ì…ë ¥ -->
                    <div class="tool-card bg-slate-50/50 p-6 rounded-2xl">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">ğŸ“§</span>
                            <h3 class="font-bold text-slate-700 text-sm">ì´ë©”ì¼ í—¤ë” í¬ë Œì‹</h3>
                        </div>
                        <textarea id="email-header-input" class="w-full h-32 p-4 bg-white border border-slate-200 rounded-xl text-xs font-mono outline-none focus:ring-2 focus:ring-indigo-500 custom-scrollbar" placeholder="Received, From, Subjectê°€ í¬í•¨ëœ í—¤ë” ì›ë¬¸ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
                        <button onclick="app.analyzeEmail()" class="w-full mt-4 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition">ìˆ˜ì‚¬ ê°œì‹œ</button>
                    </div>
                </div>
            </div>

            <!-- ë¶„ì„ ê²°ê³¼ ëŒ€ì‹œë³´ë“œ (ë°ì´í„°ê°€ ìˆì„ ë•Œë§Œ í‘œì‹œ) -->
            <div id="analysis-result-stage" class="hidden space-y-6">
                <!-- ê²°ê³¼ ìƒë‹¨ ìš”ì•½ -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 text-xs font-bold">
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm flex flex-col items-center justify-center text-center">
                        <p class="text-slate-400 uppercase mb-2">íŒŒì¼ ìœ í˜•</p>
                        <p id="res-file-type" class="text-base text-slate-800">--</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm flex flex-col items-center justify-center text-center">
                        <p class="text-slate-400 uppercase mb-2">ìœ„í˜‘ ìˆ˜ì¤€</p>
                        <p id="res-verdict" class="text-base">--</p>
                    </div>
                    <div class="md:col-span-2 bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                        <p class="text-slate-400 uppercase mb-2">MD5 / SHA256 Hash</p>
                        <p id="res-hashes" class="text-[10px] font-mono text-slate-500 leading-relaxed truncate">--</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- ìˆ˜ì‚¬ ìƒì„¸ ë¡œê·¸ (ë¹ˆ í™”ë©´ ì±„ìš°ê¸°ìš©) -->
                    <div class="bg-slate-900 text-white p-6 rounded-2xl shadow-xl">
                        <h3 class="text-xs font-bold text-indigo-400 uppercase mb-4 tracking-widest">Investigation Logs</h3>
                        <div id="analysis-logs" class="space-y-3 h-64 overflow-y-auto custom-scrollbar font-mono text-[10px]">
                            <!-- ë¡œê·¸ê°€ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                    <!-- ë¶„ì„ ìƒì„¸ ë‚´ìš© -->
                    <div class="lg:col-span-2 bg-white p-6 rounded-2xl border border-slate-200 shadow-sm h-80 overflow-y-auto custom-scrollbar">
                        <h3 class="text-xs font-bold text-slate-400 uppercase mb-4 tracking-widest">Detailed Analysis Report</h3>
                        <div id="analysis-details-content" class="text-sm text-slate-600 leading-relaxed">
                            ìˆ˜ì‚¬ ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘ì…ë‹ˆë‹¤...
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ì„¹ì…˜ 2: ë””ì½”ë“œ ì„¼í„° (ì™„ë²½ ë³µêµ¬) -->
        <section id="view-codec" class="hidden space-y-6 fade-in">
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-2xl font-black text-slate-800">ë©€í‹° ë””ì½”ë“œ ì„¼í„°</h2>
                        <p class="text-slate-500 text-xs mt-1">ë‚œë…í™”ëœ ë°ì´í„°ë¥¼ í•œëˆˆì— í•´ë…í•˜ëŠ” ì „ë¬¸ê°€ìš© ë„êµ¬ì…ë‹ˆë‹¤.</p>
                    </div>
                    <div class="flex bg-slate-100 p-1 rounded-xl">
                        <button onclick="codec.setMode('decode')" id="mode-decode" class="px-4 py-2 bg-white rounded-lg text-xs font-bold shadow-sm transition text-slate-800">Decode</button>
                        <button onclick="codec.setMode('encode')" id="mode-encode" class="px-4 py-2 text-slate-500 text-xs font-bold transition">Encode</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="space-y-4">
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Input Raw Data</label>
                        <textarea id="codec-input" class="w-full h-80 p-6 bg-slate-50 border border-slate-200 rounded-2xl text-sm font-mono focus:ring-2 focus:ring-indigo-500 outline-none custom-scrollbar" placeholder="í•´ë…í•  ë¬¸ìì—´ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <div class="space-y-6">
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Select Algorithm</label>
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                            <button onclick="codec.run('url')" class="p-4 bg-white border border-slate-200 rounded-xl text-xs font-bold hover:border-indigo-600 hover:text-indigo-600 transition">URL</button>
                            <button onclick="codec.run('base64')" class="p-4 bg-white border border-slate-200 rounded-xl text-xs font-bold hover:border-indigo-600 hover:text-indigo-600 transition">Base64</button>
                            <button onclick="codec.run('hex')" class="p-4 bg-white border border-slate-200 rounded-xl text-xs font-bold hover:border-indigo-600 hover:text-indigo-600 transition">HEX</button>
                            <button onclick="codec.run('charcode')" class="p-4 bg-white border border-slate-200 rounded-xl text-xs font-bold hover:border-indigo-600 hover:text-indigo-600 transition">CharCode</button>
                            <button onclick="codec.run('gubun')" class="p-4 bg-white border border-slate-200 rounded-xl text-xs font-bold hover:border-indigo-600 hover:text-indigo-600 transition">Gubun ì¶”ì¶œ</button>
                            <button onclick="codec.clear()" class="p-4 bg-rose-50 text-rose-600 border border-rose-100 rounded-xl text-xs font-bold hover:bg-rose-100 transition">ì´ˆê¸°í™”</button>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Result Output</label>
                            <div id="codec-output" class="w-full h-48 p-6 bg-slate-900 text-emerald-400 border border-slate-800 rounded-2xl text-sm font-mono overflow-y-auto custom-scrollbar whitespace-pre-wrap"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ì„¹ì…˜ 3: ì‹œìŠ¤í…œ ì ê²€ ì„¼í„° (ê°€ì´ë“œ ë° ìƒì„¸ ê²°ê³¼ ê°•í™”) -->
        <section id="view-system" class="hidden space-y-6 fade-in">
            <!-- ê¸°ì¡´ SSH ì—°ê²° UI ìœ ì§€ -->
            <div class="bg-indigo-950 text-white p-10 rounded-3xl shadow-2xl relative overflow-hidden mb-8">
                <div class="absolute -top-10 -right-10 w-64 h-64 bg-indigo-500/10 rounded-full blur-3xl"></div>
                <div class="relative z-10 grid grid-cols-1 lg:grid-cols-2 gap-12">
                    <div class="space-y-6">
                        <h2 class="text-3xl font-black">ì‹œìŠ¤í…œ ì·¨ì•½ì  ì „ìˆ˜ ì§„ë‹¨</h2>
                        <p class="text-indigo-200 text-sm leading-relaxed">
                            ëŒ€ìƒ ì„œë²„ì— ì›ê²© ì ‘ì†í•˜ì—¬ ë¶ˆí•„ìš”í•œ ê³„ì •, ì·¨ì•½í•œ ì„œë¹„ìŠ¤, ì˜ëª»ëœ ë„¤íŠ¸ì›Œí¬ ì„¤ì • ë“±ì„ ì§ì ‘ ìˆ˜ìƒ‰í•©ë‹ˆë‹¤. 
                            ë³¸ ì§„ë‹¨ì€ ì‹¤ì œ SSH í†µì‹ ì„ í†µí•´ ì´ë£¨ì–´ì§€ë¯€ë¡œ ì •í™•í•œ ì •ë³´ë¥¼ ì…ë ¥í•´ ì£¼ì‹­ì‹œì˜¤.
                        </p>
                        <div class="p-4 bg-white/5 rounded-2xl border border-white/10 text-xs">
                            <p class="font-bold text-indigo-300 mb-2">ğŸ’¡ ìˆ˜ì‚¬ë³¸ë¶€ ì ê²€ ê°€ì´ë“œ</p>
                            <ul class="space-y-1 text-indigo-100/70">
                                <li>- SSH (Port 22) ì—°ê²°ì´ ê°€ëŠ¥í•œ ë¦¬ëˆ…ìŠ¤/ìœ ë‹‰ìŠ¤ ì„œë²„ ê¶Œì¥</li>
                                <li>- ìœˆë„ìš° ì„œë²„ëŠ” OpenSSHê°€ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li>
                                <li>- ì¸ì¦ í‚¤ëŠ” PEM í˜•ì‹ì„ ì§€ì›í•˜ë©° ë©”ëª¨ë¦¬ì—ì„œ ì¦‰ì‹œ íœ˜ë°œë©ë‹ˆë‹¤.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="bg-white/10 p-6 rounded-2xl border border-white/20 backdrop-blur-md space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-indigo-300">Host IP</label>
                                <input type="text" id="ssh-host" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm outline-none" placeholder="192.168.0.1">
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-indigo-300">Port</label>
                                <input type="number" id="ssh-port" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm outline-none" value="22">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-indigo-300">Username</label>
                                <input type="text" id="ssh-user" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm outline-none" placeholder="root">
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-indigo-300">Password</label>
                                <input type="password" id="ssh-pass" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm outline-none" placeholder="********">
                            </div>
                        </div>
                        <button onclick="app.runSystemCheck()" id="btn-system-check" class="w-full py-3 bg-emerald-500 text-white rounded-xl font-black shadow-lg hover:bg-emerald-600 transition">ì§„ë‹¨ ê°œì‹œ</button>
                    </div>
                </div>
            </div>

            <!-- ì§„ë‹¨ ê²°ê³¼ -->
            <div id="system-result-area" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-4" id="system-check-list"></div>
                <div class="space-y-6">
                    <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200 text-center">
                        <h4 class="text-xs font-bold text-slate-400 uppercase mb-4">Security Score</h4>
                        <p class="text-6xl font-black text-slate-800" id="system-total-score">--</p>
                    </div>
                    <div class="bg-slate-900 text-white p-6 rounded-2xl border border-slate-800">
                        <h4 class="text-xs font-bold text-indigo-400 uppercase mb-4 tracking-widest">Investigation Advice</h4>
                        <p id="system-total-advice" class="text-xs leading-relaxed italic text-slate-300">--</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white border-t border-slate-200 py-8">
        <div class="max-w-7xl mx-auto px-6 text-center text-[10px] text-slate-400 font-bold uppercase tracking-widest">
            &copy; 2024 CERT Intelligence Lab. Real-Engine Integrated V3.3.
        </div>
    </footer>

    <script>
        // ---------------------------------------------------------
        // ì „ì—­ ì•± ê´€ë¦¬ì (ìˆ˜ì‚¬ ì„¼í„° í•µì‹¬ ë¡œì§)
        // ---------------------------------------------------------
        const app = {
            state: { currentView: 'analysis', targetName: '' },

            // ì„¼í„° ì „í™˜
            switchView: function(viewId) {
                document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
                document.getElementById(`view-${viewId}`).classList.remove('hidden');
                
                // ë‚´ë¹„ í™œì„±í™” ìŠ¤íƒ€ì¼
                document.querySelectorAll('nav button').forEach(b => b.classList.remove('text-indigo-400', 'border-b-2', 'border-indigo-400'));
                document.getElementById(`nav-${viewId}`).classList.add('text-indigo-400', 'border-b-2', 'border-indigo-400');
            },

            // ë¶„ì„ ë¡œê·¸ ê¸°ë¡ê¸°
            log: function(msg, isActive = false) {
                const logContainer = document.getElementById('analysis-logs');
                const line = document.createElement('div');
                line.className = `log-line ${isActive ? 'active' : ''}`;
                line.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
                logContainer.appendChild(line);
                logContainer.scrollTop = logContainer.scrollHeight;
            },

            // 1. íŒŒì¼ ë¶„ì„ ì‹¤í–‰ (Real API)
            uploadFile: async function(file) {
                if(!file) return;
                this.state.targetName = file.name;
                document.getElementById('current-target-name').innerText = file.name;
                
                document.getElementById('analysis-result-stage').classList.remove('hidden');
                const logBox = document.getElementById('analysis-logs');
                const contentBox = document.getElementById('analysis-details-content');
                logBox.innerHTML = "";
                contentBox.innerHTML = "â³ íŒŒì¼ì„ ì„œë²„ë¡œ ì „ì†¡í•˜ì—¬ ìˆ˜ì‚¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...";

                this.log(`ìˆ˜ì‚¬ ëŒ€ìƒ íŒŒì¼ ê°ì§€: ${file.name}`);
                this.log(`íŒŒì¼ í™•ì¥ì í™•ì¸: .${file.name.split('.').pop()}`, true);

                const formData = new FormData();
                formData.append("file", file);

                try {
                    this.log("ì„œë²„ì¸¡ ì •ë°€ ë¶„ì„ ì—”ì§„ í˜¸ì¶œ ì¤‘...");
                    const response = await fetch('/api/analyze/file', { method: 'POST', body: formData });
                    const data = await response.json();
                    
                    this.log("MD5/SHA256 í•´ì‹œê°’ ê³„ì‚° ì™„ë£Œ");
                    this.log("PE êµ¬ì¡° ë° ì„í¬íŠ¸ í•¨ìˆ˜ ìŠ¤ìº” ì™„ë£Œ", true);
                    this.log("ìµœì¢… ë¶„ì„ ê²°ê³¼ ìˆ˜ì‹  ì„±ê³µ");

                    // UI ì—…ë°ì´íŠ¸
                    document.getElementById('res-file-type').innerText = data.type;
                    document.getElementById('res-verdict').innerText = data.verdict;
                    document.getElementById('res-verdict').className = `text-base ${data.verdict.includes('Safe') ? 'text-emerald-500' : 'text-rose-600'}`;
                    document.getElementById('res-hashes').innerHTML = `MD5: ${data.md5}<br>SHA256: ${data.sha256}`;

                    contentBox.innerHTML = `
                        <div class="space-y-4">
                            <p class="font-bold text-indigo-600 text-base">ìˆ˜ì‚¬ê´€ ì†Œê²¬: ${data.verdict}</p>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-slate-50 p-4 rounded-xl">
                                    <p class="font-bold text-[10px] uppercase text-slate-400 mb-1">File Stats</p>
                                    <p class="text-xs">ì´ë¦„: ${data.filename}</p>
                                    <p class="text-xs">í¬ê¸°: ${(data.size/1024).toFixed(2)} KB</p>
                                    <p class="text-xs">íƒ€ì…: ${data.type}</p>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-xl">
                                    <p class="font-bold text-[10px] uppercase text-slate-400 mb-1">Security Details</p>
                                    <p class="text-xs">${data.details || 'ì¶”ê°€ ìœ„í—˜ ì§•í›„ ì—†ìŒ'}</p>
                                </div>
                            </div>
                            <div class="p-4 bg-indigo-50 border border-indigo-100 rounded-xl">
                                <p class="text-xs font-bold text-indigo-700 mb-1">ğŸ’¡ í™•ì¥ì ì•ˆë‚´</p>
                                <p class="text-[11px] text-indigo-600 leading-relaxed">
                                    í•´ë‹¹ íŒŒì¼ì€ <strong>.${file.name.split('.').pop()}</strong> í™•ì¥ìë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. 
                                    ì‹¤í–‰ íŒŒì¼ì¼ ê²½ìš° ì‹œìŠ¤í…œ APIë¥¼ í˜¸ì¶œí•˜ì—¬ ë©”ëª¨ë¦¬ ì¡°ì‘ì´ë‚˜ ì›ê²© ì ‘ì†ì„ ì‹œë„í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ íŒì • ê²°ê³¼ë¥¼ ë°˜ë“œì‹œ í™•ì¸í•˜ì‹­ì‹œì˜¤.
                                </p>
                            </div>
                        </div>
                    `;
                } catch(e) {
                    this.log(`âŒ ìˆ˜ì‚¬ ì‹¤íŒ¨: ${e.message}`);
                    contentBox.innerHTML = "ìˆ˜ì‚¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                }
            },

            // 2. ì´ë©”ì¼ ìˆ˜ì‚¬ ì‹¤í–‰ (Real API)
            analyzeEmail: async function() {
                const text = document.getElementById('email-header-input').value;
                if(!text) return alert("ìˆ˜ì‚¬í•  í—¤ë” ì›ë¬¸ì„ ì…ë ¥í•´ ì£¼ì‹­ì‹œì˜¤!");

                this.state.targetName = "Email Header Analysis";
                document.getElementById('current-target-name').innerText = this.state.targetName;
                document.getElementById('analysis-result-stage').classList.remove('hidden');
                
                const logBox = document.getElementById('analysis-logs');
                const contentBox = document.getElementById('analysis-details-content');
                logBox.innerHTML = "";
                contentBox.innerHTML = "â³ ì´ë©”ì¼ í—¤ë” í™‰(Hop) ì¶”ì  ë° ì¸ì¦ ê²€ì¦ ì¤‘...";

                this.log("í—¤ë” ë°ì´í„° ë¬´ê²°ì„± ê²€ì‚¬ ì¤‘...");
                this.log("Received í•„ë“œ ì¶”ì¶œ ë° ê²½ë¡œ ë§µí•‘ ì¤‘", true);

                try {
                    const response = await fetch('/api/analyze/email', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({header_text: text})
                    });
                    const data = await response.json();

                    this.log("ìµœì¢… ë°œì‹ ì§€ IP ì‹ë³„ ì™„ë£Œ");
                    this.log(`SPF/DKIM ì¸ì¦ ìƒíƒœ: ${data.auth_status ? 'ê²€ì¦ë¨' : 'ì •ë³´ì—†ìŒ'}`, true);

                    document.getElementById('res-file-type').innerText = "E-mail Message";
                    document.getElementById('res-verdict').innerText = data.verdict;
                    document.getElementById('res-verdict').className = `text-base ${data.verdict.includes('Normal') ? 'text-emerald-500' : 'text-rose-600'}`;
                    document.getElementById('res-hashes').innerText = `Subject: ${data.subject}`;

                    let hopHtml = "";
                    data.hops.forEach((h, i) => {
                        hopHtml += `
                            <div class="mail-hop-node ${i === data.hops.length-1 ? 'border-none' : ''}">
                                <p class="text-xs font-bold text-slate-700">Hop #${data.hops.length - i}: ${h.ips.join(', ') || 'Internal Relay'}</p>
                                <p class="text-[9px] text-slate-400 truncate">${h.raw}</p>
                            </div>
                        `;
                    });

                    contentBox.innerHTML = `
                        <div class="space-y-6">
                            <div>
                                <h4 class="text-xs font-bold text-slate-400 uppercase mb-3">E-mail Delivery Route</h4>
                                <div class="space-y-1">${hopHtml}</div>
                            </div>
                            <div class="p-4 bg-indigo-50 border border-indigo-100 rounded-xl">
                                <p class="text-xs font-bold text-indigo-700 mb-1">ğŸ’¡ ìˆ˜ì‚¬ê´€ì˜ íŒ</p>
                                <p class="text-[11px] text-indigo-600 leading-relaxed">
                                    ë°œì‹ ì§€ IP(ìµœí•˜ë‹¨ Hop)ê°€ ì‹¤ì œ ë°œì‹  ë„ë©”ì¸ ì£¼ì†Œì™€ ì¼ì¹˜í•˜ì§€ ì•Šê±°ë‚˜ í•´ì™¸ ëŒ€ì—­ì¼ ê²½ìš° ìœ„ì¥ ë©”ì¼ì¼ ê°€ëŠ¥ì„±ì´ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤.
                                </p>
                            </div>
                        </div>
                    `;
                } catch(e) {
                    this.log(`âŒ ìˆ˜ì‚¬ ì‹¤íŒ¨: ${e.message}`);
                }
            },

            // 3. ì‹œìŠ¤í…œ ì ê²€ ì‹¤í–‰ (Real SSH)
            runSystemCheck: async function() {
                const host = document.getElementById('ssh-host').value;
                const user = document.getElementById('ssh-user').value;
                const pass = document.getElementById('ssh-pass').value;

                if(!host || !user) return alert("ëŒ€ìƒ í˜¸ìŠ¤íŠ¸ì™€ ì‚¬ìš©ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”!");

                const btn = document.getElementById('btn-system-check');
                btn.disabled = true;
                btn.innerHTML = "â³ ë³´ì•ˆ ì„¸ì…˜ ìˆ˜ë¦½ ë° ì ê²€ ì¤‘...";
                document.getElementById('system-result-area').classList.add('hidden');

                try {
                    const response = await fetch('/api/system/check', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ host: host, port: parseInt(document.getElementById('ssh-port').value), username: user, password: pass })
                    });
                    const data = await response.json();
                    if(response.status !== 200) throw new Error(data.error);

                    document.getElementById('system-result-area').classList.remove('hidden');
                    document.getElementById('system-total-score').innerText = data.score;
                    document.getElementById('system-total-advice').innerText = data.score < 80 ? "ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ ë¦¬ìŠ¤íŠ¸ì˜ 'ì¡°ì¹˜ ê°€ì´ë“œ'ë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤!" : "ì‹œìŠ¤í…œì´ ê²¬ê³ í•˜ê²Œ ê´€ë¦¬ë˜ê³  ìˆìŠµë‹ˆë‹¤. ì–‘í˜¸í•œ ìƒíƒœì…ë‹ˆë‹¤.";

                    const list = document.getElementById('system-check-list');
                    list.innerHTML = data.results.map(item => `
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 check-item" onclick="this.classList.toggle('active')">
                            <div class="flex justify-between items-center">
                                <div>
                                    <span class="text-[9px] font-black px-2 py-0.5 rounded ${item.score === 100 ? 'bg-emerald-100 text-emerald-600' : 'bg-rose-100 text-rose-600'}">${item.cat}</span>
                                    <h4 class="font-bold text-slate-800 text-sm mt-1">${item.title}</h4>
                                </div>
                                <span class="text-xs font-bold ${item.score === 100 ? 'text-emerald-500' : 'text-rose-500'}">${item.result}</span>
                            </div>
                            <div class="remedy-area bg-slate-50 mt-4 rounded-xl">
                                <div class="p-4 border-t border-slate-100">
                                    <p class="text-xs font-bold text-indigo-600 mb-1">ğŸ“‹ ìˆ˜ì‚¬ê´€ ì¡°ì¹˜ ê°€ì´ë“œ</p>
                                    <p class="text-[11px] text-slate-600">${item.guide}</p>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } catch(e) { alert("ì—°ê²° ì‹¤íŒ¨: " + e.message); }
                finally { btn.disabled = false; btn.innerHTML = "ì§„ë‹¨ ê°œì‹œ"; }
            }
        };

        // ---------------------------------------------------------
        // ì½”ë± ì„¼í„° ë¡œì§ (ì™„ë²½ ë³µêµ¬)
        // ---------------------------------------------------------
        const codec = {
            mode: 'decode',
            setMode: function(m) {
                this.mode = m;
                document.getElementById('mode-decode').className = m === 'decode' ? "px-4 py-2 bg-white rounded-lg text-xs font-bold shadow-sm transition text-slate-800" : "px-4 py-2 text-slate-500 text-xs font-bold transition";
                document.getElementById('mode-encode').className = m === 'encode' ? "px-4 py-2 bg-white rounded-lg text-xs font-bold shadow-sm transition text-slate-800" : "px-4 py-2 text-slate-500 text-xs font-bold transition";
            },
            run: function(type) {
                const input = document.getElementById('codec-input').value;
                if(!input) return alert("ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
                let res = "";
                try {
                    if(type === 'url') res = this.mode === 'decode' ? decodeURIComponent(input) : encodeURIComponent(input);
                    else if(type === 'base64') res = this.mode === 'decode' ? atob(input) : btoa(input);
                    else if(type === 'hex') {
                        if(this.mode === 'decode') res = input.replace(/\s/g, '').match(/.{1,2}/g).map(h => String.fromCharCode(parseInt(h, 16))).join('');
                        else res = Array.from(input).map(c => c.charCodeAt(0).toString(16).padStart(2, '0')).join(' ');
                    }
                    else if(type === 'charcode') {
                        if(this.mode === 'decode') res = input.split(/[\s,]+/).map(c => String.fromCharCode(parseInt(c))).join('');
                        else res = Array.from(input).map(c => c.charCodeAt(0)).join(', ');
                    }
                    else if(type === 'gubun') res = input.split('
').map(l => l.substring(10, 61).trim()).join('
');
                } catch(e) { res = "ì—ëŸ¬: " + e.message; }
                document.getElementById('codec-output').innerText = res;
            },
            clear: function() { document.getElementById('codec-input').value = ""; document.getElementById('codec-output').innerText = ""; }
        };

        window.onload = () => { 
            app.init();
            app.switchView('analysis');
            console.log("CERT Integrated Headquarters V3.3 Online."); 
        };
    </script>
</body>
</html>
